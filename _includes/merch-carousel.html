<section class="container" aria-labelledby="merch-title">
  <h2 id="merch-title" class="section-title">Featured Merch</h2>

  <div class="tm-carousel" id="merch">
    <div class="tm-track">
      {% for item in site.data.merch %}
        <a class="tm-slide" href="{{ item.url | default:'#' }}">
          <article class="tm-card">
            <div class="tm-imgwrap">
              <img src="{{ item.image | default:'/assets/img/placeholders/product.png' | relative_url }}" alt="{{ item.name }}">
              {% if item.badge %}<span class="tm-badge">{{ item.badge }}</span>{% endif %}
            </div>
            <div class="tm-meta">
              <span class="tm-name">{{ item.name }}</span>
              <span class="tm-price">{{ item.price | prepend:'$' }}</span>
            </div>
          </article>
        </a>
      {% endfor %}
    </div>
    <div class="tm-dots" aria-label="carousel navigation"></div>
  </div>

  <script>
  (function(){
    const root = document.getElementById('merch');
    if(!root) return;
    const track = root.querySelector('.tm-track');
    const slides = Array.from(root.querySelectorAll('.tm-slide'));
    const dots = root.querySelector('.tm-dots');
    let i = 0;

    function renderDots(){
      dots.innerHTML = '';
      slides.forEach((_,idx)=>{
        const b = document.createElement('button');
        if(idx===i) b.classList.add('active');
        b.addEventListener('click',()=>go(idx));
        dots.appendChild(b);
      });
    }
    function go(idx){
      i = Math.max(0, Math.min(idx, slides.length-1));
      const width = slides[0].getBoundingClientRect().width + 12; // gap
      track.style.transform = `translateX(${-i * width}px)`;
      renderDots();
    }
    renderDots();
    window.addEventListener('resize', ()=>go(i));
  })();
  </script>
</section>
