{%- comment -%}
Usage:
{% include picture.html
   src="news/ap-highlight.webp"    
   alt=some_title
   widths="480,768,1100,1600"
   sizes="(min-width:960px) 50vw, 100vw"
   class="news-thumb-pic"
%}
This expects files in /assets/img/<dir>/<name>-<width>.(avif|webp|jpg)
{%- endcomment -%}

{%- assign _src = include.src | default: "" -%}
{%- assign _alt = include.alt | default: "" -%}
{%- assign _class = include.class | default: "" -%}
{%- assign _sizes = include.sizes | default: "100vw" -%}
{%- assign widths_str = include.widths | default: "480,768,1100,1600" -%}
{%- assign widths = widths_str | split: "," -%}

{%- assign stripped = _src | remove_first: "/assets/img_src/" | remove_first: "/assets/img/" | remove_first: "/" -%}
{%- assign parts = stripped | split: "." -%}
{%- assign ext = parts | last -%}
{%- assign base = parts | slice: 0, parts.size | pop | join: "." -%} {# e.g. news/ap-highlight #}
{%- assign first_w = widths | first | strip -%}
{%- assign last_w  = widths | last  | strip -%}

<picture class="{{ _class }}">
  <source type="image/avif"
          srcset="{% for w in widths %}/assets/img/{{ base }}-{{ w | strip }}.avif {{ w | strip }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
          sizes="{{ _sizes }}">
  <source type="image/webp"
          srcset="{% for w in widths %}/assets/img/{{ base }}-{{ w | strip }}.webp {{ w | strip }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
          sizes="{{ _sizes }}">
  <img
    src="/assets/img/{{ base }}-{{ first_w }}.jpg"
    alt="{{ _alt | escape }}"
    loading="lazy" decoding="async" width="{{ last_w }}" height="auto">
</picture>
